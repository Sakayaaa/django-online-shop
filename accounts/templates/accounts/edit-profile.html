{% extends 'core/base.html' %}
{% block title %}
  Edit Profile - DigiStore
{% endblock %}

{% block content %}
  <div class="card mx-auto p-4" style="max-width:720px">
    <h3>Edit Profile</h3>
    <br>
    <form method="post">
      {% csrf_token %}

      <!-- User info -->
      <div class="mb-3">
        <label class="form-label fw-bold">First Name</label>
        <input type="text" name="first_name" class="form-control" value="{{ form.first_name.value }}" />
      </div>

      <div class="mb-3">
        <label class="form-label fw-bold">Last Name</label>
        <input type="text" name="last_name" class="form-control" value="{{ form.last_name.value }}" />
      </div>

      <div class="mb-3">
        <label class="form-label fw-bold">Email</label>
        <input type="email" name="email" class="form-control" value="{{ form.email.value }}" />
      </div>

      <hr />
      <h5 class="form-label fw-bold">Addresses</h5>
      <div id="address-container">
        {% for addr in addresses %}
          <div class="address-box mb-3 p-3" style="border:1px solid black; position: relative;">
            <button type="button" class="btn btn-danger remove-address" style="position:absolute; top:5px; right:5px; width:30px; height:30px; font-size:14px; padding:0;">ðŸ—‘</button>
            <div class="mb-2">
              <label>City</label>
              <input type="text" name="city[]" class="form-control" value="{{ addr.city }}" />
            </div>
            <div class="mb-2">
              <label>Street</label>
              <input type="text" name="street[]" class="form-control" value="{{ addr.street }}" />
            </div>
            <div class="mb-2">
              <label>House Number</label>
              <input type="text" name="number[]" class="form-control" value="{{ addr.number }}" />
            </div>
            <div class="mb-2">
              <label>Postal Code</label>
              <input type="text" name="postal_code[]" class="form-control" value="{{ addr.postal_code }}" />
            </div>
          </div>
        {% endfor %}
      </div>

      <button type="button" id="add-address" class="btn btn-outline-secondary mb-3">+ Add Address</button>
      <br />
      <button type="submit" class="btn btn-danger">Save Changes</button>
    </form>
  </div>

  <script>
    const addBtn = document.getElementById('add-address')
    const container = document.getElementById('address-container')
    
    function createAddressBox() {
      const div = document.createElement('div')
      div.className = 'address-box mb-3 p-3'
      div.style = 'border:1px solid black; position: relative;'
      div.innerHTML = `
              <button type="button" class="btn btn-danger remove-address" 
                      style="position:absolute; top:5px; right:5px; width:30px; height:30px; font-size:20px; padding:0;">ðŸ—‘
              </button>
              <div class="mb-2"><label>City</label><input type="text" name="city[]" class="form-control"></div>
              <div class="mb-2"><label>Street</label><input type="text" name="street[]" class="form-control"></div>
              <div class="mb-2"><label>House Number</label><input type="text" name="number[]" class="form-control"></div>
              <div class="mb-2"><label>Postal Code</label><input type="text" name="postal_code[]" class="form-control"></div>
            `
      attachRemove(div)
      return div
    }
    
    addBtn.addEventListener('click', () => {
      const current = container.querySelectorAll('.address-box').length
      if (current < 5) {
        const newBox = createAddressBox()
        container.appendChild(newBox)
      } else {
        alert('You can add up to 5 addresses only.')
      }
    })
    
    function attachRemove(box) {
      const btn = box.querySelector('.remove-address')
      btn.addEventListener('click', () => box.remove())
    }
    
    document.querySelectorAll('.address-box').forEach(attachRemove)
  </script>
{% endblock %}
